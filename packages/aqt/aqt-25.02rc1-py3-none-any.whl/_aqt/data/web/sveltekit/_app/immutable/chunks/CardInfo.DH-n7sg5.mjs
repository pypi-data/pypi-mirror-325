import{a as F,b as C,c as De,n as Me}from"./disclose-version.CZXCSga2.mjs";import{i as re}from"./legacy.Cvgq_wkp.mjs";import{p as ie,c as u,t as D,r as o,b as se,l as U,a as de,N as g,g as v,m as J,s as O,M as te,f as ce}from"./runtime.NF8NW0fQ.mjs";import{p as ee,i as z}from"./props.C4_rjmFK.mjs";import{c as Ie,C as je}from"./Container.6BinmbdA.mjs";import{R as me}from"./Row.jCQC9Xwa.mjs";import{a as k,s as Ke,p as ae,b as Ye}from"./store.CrzbHEEA.mjs";import{U as Pe,V as We,W as Be,X as Ge,Y as Oe,Z as Ue,_ as Re,$ as $e,a0 as ze,a1 as Le,a2 as Fe,a3 as He,a4 as Ve,a5 as Je,a6 as Xe,a7 as Ze,a8 as Qe,a9 as et,aa as tt,ab as at,ac as rt,ad as it,ae as st,af as lt,ag as nt,ah as ot,q as Se,ai as we,aj as vt,ak as ct,al as dt,am as ut,an as ft,ao as mt,ap as pt,aq as gt,ar as bt,u as ht,as as ne,at as yt,au as _t,av as St,aw as wt}from"./runtime-require.D-4W5vzX.mjs";import{e as Z,i as Q}from"./theme.Bkixu2VD.mjs";import{t as G,D as xt,T as ke}from"./time.Btfahugi.mjs";import{R as P}from"./backend.CuvxjHSt.mjs";import{y as Dt,z as pe,A as Rt,B as $t,C as Lt,D as Ft,E as kt,F as xe,G as Tt,H as Ct,I as Et,J as At,K as Nt,L as qt,N as Mt,M as It}from"./HoverColumns.CILdt_V6.mjs";import{m as jt}from"./min.D1slsF82.mjs";import{t as Kt}from"./time.UaAwLPcc.mjs";import{b as oe}from"./input.Cvf2xTFQ.mjs";import{b as Yt}from"./this.COGKo2H1.mjs";import{w as Pt}from"./index.BmKPAsrv.mjs";var Wt=C('<div class="card-info-placeholder svelte-16vamgt"> </div>');function Bt(n,f){ie(f,!1),re();var i=Wt(),a=u(i,!0);D(()=>k(a,Pe())),o(i),F(n,i),se()}var Gt=C('<tr><th class="align-start svelte-1ws7hzc"> </th><td> </td></tr>'),Ot=C('<table class="stats-table align-start svelte-1ws7hzc"><tbody></tbody></table>');function Ut(n,f){ie(f,!1);let i=ee(f,"stats",8);function a(e){return new ke(Number(e)).dateString()}function d(e){const l=[];if(l.push({label:We(),value:a(e.added)}),e.firstReview!=null&&l.push({label:Be(),value:a(e.firstReview)}),e.latestReview!=null&&l.push({label:Ge(),value:a(e.latestReview)}),e.dueDate!=null&&l.push({label:Oe(),value:a(e.dueDate)}),e.duePosition!=null&&l.push({label:Ue(),value:e.duePosition}),e.interval&&l.push({label:Re(),value:G(e.interval*xt)}),e.memoryState){let y=G(e.memoryState.stability*86400,!1,!1);if(e.memoryState.stability>31){const t=e.memoryState.stability.toFixed(0);y+=` (${t})`}l.push({label:$e(),value:y});const m=((e.memoryState.difficulty-1)/9*100).toFixed(0);if(l.push({label:ze(),value:`${m}%`}),e.fsrsRetrievability){const t=(e.fsrsRetrievability*100).toFixed(0);l.push({label:Le(),value:`${t}%`})}}else e.ease&&l.push({label:Fe(),value:`${e.ease/10}%`});l.push({label:He(),value:e.reviews}),l.push({label:Ve(),value:e.lapses}),e.totalSecs&&(l.push({label:Je(),value:G(e.averageSecs)}),l.push({label:Xe(),value:G(e.totalSecs)})),l.push({label:Ze(),value:e.cardType}),l.push({label:Qe(),value:e.notetype});let x;if(e.originalDeck?x=`${e.deck} (${e.originalDeck})`:x=e.deck,l.push({label:et(),value:x}),l.push({label:tt(),value:e.preset}),l.push({label:at(),value:e.cardId}),l.push({label:rt(),value:e.noteId}),e.customData){let y;try{const m=JSON.parse(e.customData);y=Object.entries(m).map(([t,c])=>`${t}=${c}`).join(" ")}catch{y=e.customData}l.push({label:it(),value:y})}return l}let s=J();U(()=>te(i()),()=>{O(s,d(i()))}),de(),re();var w=Ot(),T=u(w);Z(T,5,()=>v(s),Q,(e,l)=>{var x=Gt(),y=u(x),m=u(y,!0);o(y);var t=g(y),c=u(t,!0);o(t),o(x),D(()=>{k(m,v(l).label),k(c,v(l).value)}),F(e,x)}),o(T),o(w),F(n,w),se()}const zt=19/81,Ht=-.5,Vt=1e3;function ve(n,f){return Math.pow(f/n*zt+1,Ht)}var S=(n=>(n[n.Week=0]="Week",n[n.Month=1]="Month",n[n.Year=2]="Year",n[n.AllTime=3]="AllTime",n))(S||{});const Jt={0:7,1:30,2:365,3:1/0};function Xt(n,f){return n.filter(i=>i.daysSinceFirstLearn<=f)}function ge(n){return n.reviewKind!==P.MANUAL&&n.reviewKind!==P.RESCHEDULED&&(n.reviewKind!==P.FILTERED||n.ease!==0)}function Zt(n){const f=[];for(const i of n){if(i.reviewKind===P.MANUAL&&i.ease===0)break;f.push(i)}return f.filter(i=>ge(i))}function Qt(n,f){const i=[];let a=0,d=0;const s=Math.min(f/Vt,1);let w=0;if(n.slice().reverse().forEach((c,b)=>{var $,N;const _=Number(c.time);if(b===0){a=_,d=(($=c.memoryState)==null?void 0:$.stability)||0,i.push({date:new Date(_*1e3),daysSinceFirstLearn:0,elapsedDaysSinceLastReview:0,retrievability:100,stability:d});return}const E=(_-a)/86400;let I=0;for(;I<E-s;){I+=s;const r=ve(d,I);i.push({date:new Date((a+I*86400)*1e3),daysSinceFirstLearn:i[i.length-1].daysSinceFirstLearn+s,elapsedDaysSinceLastReview:I,retrievability:r*100,stability:d})}w+=E,i.push({date:new Date((a+E*86400)*1e3),daysSinceFirstLearn:w,retrievability:100,elapsedDaysSinceLastReview:0,stability:d}),a=_,d=((N=c.memoryState)==null?void 0:N.stability)||0}),i.length===0)return[];const T=Date.now()/1e3,e=(T-a)/86400;let l=0;for(;l<e-s;){l+=s;const c=ve(d,l);i.push({date:new Date((a+l*86400)*1e3),daysSinceFirstLearn:i[i.length-1].daysSinceFirstLearn+s,elapsedDaysSinceLastReview:l,retrievability:c*100,stability:d})}w+=e;const x=ve(d,e);i.push({date:new Date(T*1e3),daysSinceFirstLearn:w,elapsedDaysSinceLastReview:e,retrievability:x*100,stability:d});const y=f-e;let m=0;for(;m<y;){m+=s;const c=ve(d,l+m);i.push({date:new Date((T+m*86400)*1e3),daysSinceFirstLearn:i[i.length-1].daysSinceFirstLearn+s,elapsedDaysSinceLastReview:e+m,retrievability:c*100,stability:d})}return Xt(i,f)}function Te(n,f){if(n.length===0)return 0;const i=new Date,a=(i.getTime()/1e3-Number(n[n.length-1].time))/86400,d=(i.getTime()/1e3-Number(n[0].time))/86400,s=n[0].interval/86400,w=Math.max(s*1.5-d,s*.5);return Math.min(a+w,Jt[f])}function ea(n,f,i,a,d){const s=Dt(i),w=s.transition().duration(600);if(n.length===0){pe(s,!1);return}const T=Te(n,f),e=Qt(n,T);if(e.length===0){pe(s,!1);return}else pe(s,!0);s.selectAll(".forgetting-curve-line").remove(),s.select(".hover-columns").remove();const l=jt(e,r=>r.date),x=Rt(e,r=>r.date),y=Kt().domain([l,x]).range([a.marginLeft,a.width-a.marginRight]),m=Math.max(0,100-1.2*(100-Math.min(...e.map(r=>r.retrievability)))),t=$t().domain([m,100]).range([a.height-a.marginBottom,a.marginTop]);s.select(".x-ticks").call(r=>r.transition(w).call(Lt(y).ticks(5).tickSizeOuter(0))).attr("direction","ltr"),s.select(".y-ticks").attr("transform",`translate(${a.marginLeft},0)`).call(r=>r.transition(w).call(Ft(t).tickSizeOuter(0))).attr("direction","ltr"),s.select(".y-ticks .y-axis-title").remove(),s.select(".y-ticks").append("text").attr("class","y-axis-title").attr("transform","rotate(-90)").attr("y",0-a.marginLeft).attr("x",0-a.height/2).attr("font-size","1rem").attr("dy","1.1em").attr("fill","currentColor");const c=kt().x(r=>y(r.date)).y(r=>t(r.retrievability)),b=d*100;s.append("linearGradient").attr("id","line-gradient").attr("gradientUnits","userSpaceOnUse").attr("x1",0).attr("y1",t(0)).attr("x2",0).attr("y2",t(100)).selectAll("stop").data([{offset:"0%",color:"tomato"},{offset:`${b}%`,color:"steelblue"},{offset:"100%",color:"green"}]).enter().append("stop").attr("offset",r=>r.offset).attr("stop-color",r=>r.color);const _=new Date,E=e.filter(r=>r.date<=_),I=e.filter(r=>r.date>=_);s.append("path").datum(E).attr("class","forgetting-curve-line").attr("fill","none").attr("stroke","url(#line-gradient)").attr("stroke-width",1.5).attr("d",c),s.append("path").datum(I).attr("class","forgetting-curve-line").attr("fill","none").attr("stroke","url(#line-gradient)").attr("stroke-width",1.5).attr("stroke-dasharray","4 4").attr("d",c),s.select(".desired-retention-line").remove(),b>m&&s.append("line").attr("class","desired-retention-line").attr("x1",a.marginLeft).attr("x2",a.width-a.marginRight).attr("y1",t(b)).attr("y2",t(b)).attr("stroke","steelblue").attr("stroke-dasharray","4 4").attr("stroke-width",1.2);const $=s.append("line").attr("class","focus-line").attr("y1",a.marginTop).attr("y2",a.height-a.marginBottom).attr("stroke","black").attr("stroke-width",1).style("opacity",0);function N(r){return`${T>=365?"Date":"Date Time"}: ${T>=365?r.date.toLocaleDateString():r.date.toLocaleString()}<br>
        ${lt()}: ${G(r.elapsedDaysSinceLastReview*86400)}<br>${Le()}: ${r.retrievability.toFixed(2)}%<br>${$e()}: ${G(r.stability*86400)}`}s.append("g").attr("class","hover-columns").selectAll("rect").data(e).join("rect").attr("x",r=>y(r.date)-1).attr("y",a.marginTop).attr("width",2).attr("height",a.height-a.marginTop-a.marginBottom).attr("fill","transparent").on("mousemove",(r,q)=>{const[W,H]=xe(r,document.body),[le,X]=xe(r,s.node()),V=t(b);$.attr("x1",y(q.date)-1).attr("x2",y(q.date)+1).style("opacity",1);let R=N(q);X>=V-10&&X<=V+10&&(R+=`<br>${st()}: ${d.toFixed(2)}`),Tt(R,W,H)}).on("mouseout",()=>{$.style("opacity",0),Ct()})}var ta=C('<div class="svelte-1bf093q"><b> </b> <span class="hidden-xs svelte-1bf093q"> </span></div>'),aa=C("<div> </div>"),ra=C("<div> </div>"),ia=C('<div class="svelte-1bf093q"> </div>'),sa=C('<div class="svelte-1bf093q"> </div>'),la=C('<div class="svelte-1bf093q"> </div>'),na=C('<div class="revlog-table svelte-1bf093q"><div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column hidden-xs svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content right svelte-1bf093q"></div></div> <div class="column hidden-xs svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content right svelte-1bf093q"></div></div> <!></div>');function oa(n,f){ie(f,!1);const i=J();let a=ee(f,"revlog",8),d=ee(f,"fsrsEnabled",8,!1);function s(t){switch(t.reviewKind){case P.LEARNING:return"revlog-learn";case P.REVIEW:return"revlog-review";case P.RELEARNING:return"revlog-relearn"}return""}function w(t){switch(t.reviewKind){case P.LEARNING:return gt();case P.REVIEW:return pt();case P.RELEARNING:return mt();case P.FILTERED:return ft();case P.MANUAL:return ut();case P.RESCHEDULED:return dt()}}function T(t){return t.buttonChosen===1?"revlog-ease1":""}function e(t,c){var _;const b=new ke(Number(t.time));return{date:b.dateString(),time:b.timeString(),reviewKind:w(t),reviewKindClass:s(t),rating:t.buttonChosen,ratingClass:T(t),interval:G(t.interval),ease:l(t.ease),takenSecs:G(t.takenSecs,!0),elapsedTime:c,stability:(_=t.memoryState)!=null&&_.stability?G(t.memoryState.stability*86400):""}}function l(t){if(t===0)return"";const c=t/10;return c<=110?`D:${(c-10).toFixed(0)}%`:`${c.toFixed(0)}%`}U(()=>(te(a()),G),()=>{O(i,a().map((t,c)=>{let b,_=c+1;for(;_<a().length;){if(ge(a()[_])){b=a()[_];break}_++}let E="N/A";return ge(t)&&(E=b?G(Number(t.time)-Number(b.time)):"0"),e(t,E)}))}),de(),re();var x=De(),y=ce(x);{var m=t=>{var c=na(),b=u(c),_=u(b),E=u(_,!0);D(()=>k(E,nt())),o(_);var I=g(_,2);Z(I,5,()=>v(i),Q,(j,K)=>{var h=ta(),Y=u(h),Ne=u(Y,!0);o(Y);var ye=g(Y,2),qe=u(ye);o(ye),o(h),D(()=>{var _e;k(Ne,v(K).date),k(qe,`@ ${(_e=v(K).time)!=null?_e:""}`)}),F(j,h)}),o(I),o(b);var $=g(b,2),N=u($),r=u(N,!0);D(()=>k(r,ot())),o(N);var q=g(N,2);Z(q,5,()=>v(i),Q,(j,K)=>{var h=aa(),Y=u(h,!0);o(h),D(()=>{Se(h,we(v(K).reviewKindClass),"svelte-1bf093q"),k(Y,v(K).reviewKind)}),F(j,h)}),o(q),o($);var W=g($,2),H=u(W),le=u(H,!0);D(()=>k(le,vt())),o(H);var X=g(H,2);Z(X,5,()=>v(i),Q,(j,K)=>{var h=ra(),Y=u(h,!0);o(h),D(()=>{Se(h,we(v(K).ratingClass),"svelte-1bf093q"),k(Y,v(K).rating)}),F(j,h)}),o(X),o(W);var V=g(W,2),R=u(V),A=u(R,!0);D(()=>k(A,Re())),o(R);var p=g(R,2);Z(p,5,()=>v(i),Q,(j,K)=>{var h=ia(),Y=u(h,!0);o(h),D(()=>k(Y,v(K).interval)),F(j,h)}),o(p),o(V);var M=g(V,2),B=u(M),L=u(B,!0);D(()=>k(L,Fe())),o(B);var be=g(B,2);Z(be,5,()=>v(i),Q,(j,K)=>{var h=sa(),Y=u(h,!0);o(h),D(()=>k(Y,v(K).ease)),F(j,h)}),o(be),o(M);var ue=g(M,2),fe=u(ue),Ce=u(fe,!0);D(()=>k(Ce,ct())),o(fe);var he=g(fe,2);Z(he,5,()=>v(i),Q,(j,K)=>{var h=la(),Y=u(h,!0);o(h),D(()=>k(Y,v(K).takenSecs)),F(j,h)}),o(he),o(ue);var Ee=g(ue,2);{var Ae=j=>{};z(Ee,j=>{d()&&j(Ae)})}o(c),F(t,c)};z(y,t=>{a().length>0&&t(m)})}F(n,x),se()}var va=C('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),ca=C('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),da=C('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),ua=C('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),fa=C('<div class="time-range-selector svelte-6ja67r"><!> <!> <!> <!></div>'),ma=Me("<svg><!><!><!></svg>"),pa=C('<div class="forgetting-curve svelte-6ja67r"><!> <!></div>');function ga(n,f){ie(f,!1);const i=Ke(),a=()=>Ye(t,"$timeRange",i),d=J(),s=J(),w=[];let T=ee(f,"revlog",8),e=ee(f,"desiredRetention",8),l=J(null);const x=It(),y=bt();let m=J(S.Week);const t=Pt(v(m));U(()=>te(T()),()=>{O(d,Zt(T()))}),U(()=>(v(d),S),()=>{O(s,Te(v(d),S.AllTime))}),U(()=>(v(s),S),()=>{v(s)>365?O(m,S.AllTime):v(s)>30?O(m,S.Year):v(s)>7&&O(m,S.Month)}),U(()=>v(m),()=>{ae(t,v(m))}),U(()=>(v(d),a(),v(l),te(e())),()=>{ea(v(d),a(),v(l),x,e())}),de(),re();var c=pa(),b=u(c);Et(b,{children:(E,I)=>{var $=fa(),N=u($);{var r=R=>{var A=va(),p=u(A);ne(p);var M,B=g(p);D(()=>{var L;return k(B,` ${(L=yt())!=null?L:""}`)}),o(A),D(()=>{M!==(M=S.Week)&&(p.value=(p.__value=S.Week)==null?"":S.Week)}),oe(w,[],p,()=>(S.Week,a()),L=>ae(t,L)),F(R,A)};z(N,R=>{v(s)>0&&R(r)})}var q=g(N,2);{var W=R=>{var A=ca(),p=u(A);ne(p);var M,B=g(p);D(()=>{var L;return k(B,` ${(L=_t())!=null?L:""}`)}),o(A),D(()=>{M!==(M=S.Month)&&(p.value=(p.__value=S.Month)==null?"":S.Month)}),oe(w,[],p,()=>(S.Month,a()),L=>ae(t,L)),F(R,A)};z(q,R=>{v(s)>7&&R(W)})}var H=g(q,2);{var le=R=>{var A=da(),p=u(A);ne(p);var M,B=g(p);D(()=>{var L;return k(B,` ${(L=St())!=null?L:""}`)}),o(A),D(()=>{M!==(M=S.Year)&&(p.value=(p.__value=S.Year)==null?"":S.Year)}),oe(w,[],p,()=>(S.Year,a()),L=>ae(t,L)),F(R,A)};z(H,R=>{v(s)>30&&R(le)})}var X=g(H,2);{var V=R=>{var A=ua(),p=u(A);ne(p);var M,B=g(p);D(()=>{var L;return k(B,` ${(L=wt())!=null?L:""}`)}),o(A),D(()=>{M!==(M=S.AllTime)&&(p.value=(p.__value=S.AllTime)==null?"":S.AllTime)}),oe(w,[],p,()=>(S.AllTime,a()),L=>ae(t,L)),F(R,A)};z(X,R=>{v(s)>365&&R(V)})}o($),F(E,$)},$$slots:{default:!0}});var _=g(b,2);At(_,{title:y,children:(E,I)=>{var $=ma(),N=u($);Nt(N,{bounds:x});var r=g(N);qt(r);var q=g(r);Mt(q,{bounds:x}),o($),Yt($,W=>O(l,W),()=>v(l)),D(()=>ht($,"viewBox",`0 0 ${x.width} ${x.height}`)),F(E,$)},$$slots:{default:!0}}),o(c),F(n,c),se()}var ba=C("<!> <!> <!>",1),ha=C('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function Ma(n,f){ie(f,!1);const i=J(),a=J();let d=ee(f,"stats",8,null),s=ee(f,"showRevlog",8,!0);U(()=>te(d()),()=>{var e;O(i,((e=d())==null?void 0:e.memoryState)!=null)}),U(()=>te(d()),()=>{var e,l;O(a,(l=(e=d())==null?void 0:e.desiredRetention)!=null?l:.9)}),de(),re();var w=ha(),T=ce(w);Ie(T,()=>({"--gutter-inline":"1rem","--gutter-block":"0.5rem"})),je(T.lastChild,{breakpoint:"md",children:(e,l)=>{var x=De(),y=ce(x);{var m=c=>{var b=ba(),_=ce(b);me(_,{children:(r,q)=>{Ut(r,{get stats(){return d()}})},$$slots:{default:!0}});var E=g(_,2);{var I=r=>{me(r,{children:(q,W)=>{oa(q,{get revlog(){return d().revlog},get fsrsEnabled(){return v(i)}})},$$slots:{default:!0}})};z(E,r=>{s()&&r(I)})}var $=g(E,2);{var N=r=>{me(r,{children:(q,W)=>{ga(q,{get revlog(){return d().revlog},get desiredRetention(){return v(a)}})},$$slots:{default:!0}})};z($,r=>{v(i)&&r(N)})}F(c,b)},t=c=>{Bt(c,{})};z(y,c=>{d()?c(m):c(t,!1)})}F(e,x)},$$slots:{default:!0}}),o(T),F(n,w),se()}export{Ma as C};
