const L=/\{[^{}]+\}/g;function v(){return Math.random().toString(36).slice(2,11)}function F(r){let{baseUrl:n="",Request:e=globalThis.Request,fetch:i=globalThis.fetch,querySerializer:t,bodySerializer:s,headers:a,...f}={...r};n=C(n);const d=[];async function y(o,l){const{baseUrl:b,fetch:x=i,Request:Q=e,headers:I,params:R={},parseAs:p="json",querySerializer:w,bodySerializer:E=s??W,body:O,...g}=l||{};b&&(n=C(b));let $=typeof t=="function"?t:U(t);w&&($=typeof w=="function"?w:U({...typeof t=="object"?t:{},...w}));const S=O===void 0?void 0:E(O),P=S===void 0||S instanceof FormData?{}:{"Content-Type":"application/json"},k={redirect:"follow",...f,...g,body:S,headers:M(P,a,I,R.header)};let z,A,m=new e(B(o,{baseUrl:n,params:R,querySerializer:$}),k);for(const u in g)u in m||(m[u]=g[u]);if(d.length){z=v(),A=Object.freeze({baseUrl:n,fetch:x,parseAs:p,querySerializer:$,bodySerializer:E});for(const u of d)if(u&&typeof u=="object"&&typeof u.onRequest=="function"){const h=await u.onRequest({request:m,schemaPath:o,params:R,options:A,id:z});if(h){if(!(h instanceof e))throw new Error("onRequest: must return new Request() when modifying the request");m=h}}}let c=await x(m);if(d.length)for(let u=d.length-1;u>=0;u--){const h=d[u];if(h&&typeof h=="object"&&typeof h.onResponse=="function"){const q=await h.onResponse({request:m,response:c,schemaPath:o,params:R,options:A,id:z});if(q){if(!(q instanceof Response))throw new Error("onResponse: must return new Response() when modifying the response");c=q}}}if(c.status===204||c.headers.get("Content-Length")==="0")return c.ok?{data:void 0,response:c}:{error:void 0,response:c};if(c.ok)return p==="stream"?{data:c.body,response:c}:{data:await c[p](),response:c};let T=await c.text();try{T=JSON.parse(T)}catch{}return{error:T,response:c}}return{GET(o,l){return y(o,{...l,method:"GET"})},PUT(o,l){return y(o,{...l,method:"PUT"})},POST(o,l){return y(o,{...l,method:"POST"})},DELETE(o,l){return y(o,{...l,method:"DELETE"})},OPTIONS(o,l){return y(o,{...l,method:"OPTIONS"})},HEAD(o,l){return y(o,{...l,method:"HEAD"})},PATCH(o,l){return y(o,{...l,method:"PATCH"})},TRACE(o,l){return y(o,{...l,method:"TRACE"})},use(...o){for(const l of o)if(l){if(typeof l!="object"||!("onRequest"in l||"onResponse"in l))throw new Error("Middleware must be an object with one of `onRequest()` or `onResponse()`");d.push(l)}},eject(...o){for(const l of o){const b=d.indexOf(l);b!==-1&&d.splice(b,1)}}}}function j(r,n,e){if(n==null)return"";if(typeof n=="object")throw new Error("Deeply-nested arrays/objects arenâ€™t supported. Provide your own `querySerializer()` to handle these.");return`${r}=${(e==null?void 0:e.allowReserved)===!0?n:encodeURIComponent(n)}`}function H(r,n,e){if(!n||typeof n!="object")return"";const i=[],t={simple:",",label:".",matrix:";"}[e.style]||"&";if(e.style!=="deepObject"&&e.explode===!1){for(const f in n)i.push(f,e.allowReserved===!0?n[f]:encodeURIComponent(n[f]));const a=i.join(",");switch(e.style){case"form":return`${r}=${a}`;case"label":return`.${a}`;case"matrix":return`;${r}=${a}`;default:return a}}for(const a in n){const f=e.style==="deepObject"?`${r}[${a}]`:a;i.push(j(f,n[a],e))}const s=i.join(t);return e.style==="label"||e.style==="matrix"?`${t}${s}`:s}function D(r,n,e){if(!Array.isArray(n))return"";if(e.explode===!1){const s={form:",",spaceDelimited:"%20",pipeDelimited:"|"}[e.style]||",",a=(e.allowReserved===!0?n:n.map(f=>encodeURIComponent(f))).join(s);switch(e.style){case"simple":return a;case"label":return`.${a}`;case"matrix":return`;${r}=${a}`;default:return`${r}=${a}`}}const i={simple:",",label:".",matrix:";"}[e.style]||"&",t=[];for(const s of n)e.style==="simple"||e.style==="label"?t.push(e.allowReserved===!0?s:encodeURIComponent(s)):t.push(j(r,s,e));return e.style==="label"||e.style==="matrix"?`${i}${t.join(i)}`:t.join(i)}function U(r){return function(e){const i=[];if(e&&typeof e=="object")for(const t in e){const s=e[t];if(s!=null){if(Array.isArray(s)){if(s.length===0)continue;i.push(D(t,s,{style:"form",explode:!0,...r==null?void 0:r.array,allowReserved:(r==null?void 0:r.allowReserved)||!1}));continue}if(typeof s=="object"){i.push(H(t,s,{style:"deepObject",explode:!0,...r==null?void 0:r.object,allowReserved:(r==null?void 0:r.allowReserved)||!1}));continue}i.push(j(t,s,r))}}return i.join("&")}}function N(r,n){let e=r;for(const i of r.match(L)??[]){let t=i.substring(1,i.length-1),s=!1,a="simple";if(t.endsWith("*")&&(s=!0,t=t.substring(0,t.length-1)),t.startsWith(".")?(a="label",t=t.substring(1)):t.startsWith(";")&&(a="matrix",t=t.substring(1)),!n||n[t]===void 0||n[t]===null)continue;const f=n[t];if(Array.isArray(f)){e=e.replace(i,D(t,f,{style:a,explode:s}));continue}if(typeof f=="object"){e=e.replace(i,H(t,f,{style:a,explode:s}));continue}if(a==="matrix"){e=e.replace(i,`;${j(t,f)}`);continue}e=e.replace(i,a==="label"?`.${encodeURIComponent(f)}`:encodeURIComponent(f))}return e}function W(r){return r instanceof FormData?r:JSON.stringify(r)}function B(r,n){var t;let e=`${n.baseUrl}${r}`;(t=n.params)!=null&&t.path&&(e=N(e,n.params.path));let i=n.querySerializer(n.params.query??{});return i.startsWith("?")&&(i=i.substring(1)),i&&(e+=`?${i}`),e}function M(...r){const n=new Headers;for(const e of r){if(!e||typeof e!="object")continue;const i=e instanceof Headers?e.entries():Object.entries(e);for(const[t,s]of i)if(s===null)n.delete(t);else if(Array.isArray(s))for(const a of s)n.append(t,a);else s!==void 0&&n.set(t,s)}return n}function C(r){return r.endsWith("/")?r.substring(0,r.length-1):r}const G=F({baseUrl:"http://localhost:8001/"});export{G as c};
