"use strict";(self.webpackChunkjupyter_exam=self.webpackChunkjupyter_exam||[]).push([[675],{675:(e,t,o)=>{o.r(t),o.d(t,{default:()=>u});var n=o(593),a=o(209),r=o(123),s=o(256),c=o(310),i=o(421);async function d(e="",t={}){const o=i.ServerConnection.makeSettings(),n=c.URLExt.join(o.baseUrl,"jupyter-exam",e);let a;try{a=await i.ServerConnection.makeRequest(n,t,o)}catch(e){throw new i.ServerConnection.NetworkError(e)}let r=await a.text();if(r.length>0)try{r=JSON.parse(r)}catch(e){console.log("Not a JSON response body.",a)}if(!a.ok)throw new i.ServerConnection.ResponseError(a,r.message||r);return r}const m={id:"jupyter_exam:plugin",description:"A JupyterLab extension to collect exam files",autoStart:!0,requires:[a.ICommandPalette,r.INotebookTracker],optional:[n.ISettingRegistry],activate:(e,t,o,n)=>{console.log("JupyterLab extension jupyter_exam is activated!");const{commands:r}=e,c=document.createElement("div");c.textContent="";const i=new s.Widget({node:c});i.id=a.DOMUtils.createDomID(),i.addClass("jp-UserWidget"),e.shell.add(i,"top",{rank:1e3});const u=document.createElement("div");u.textContent="submit";const l=new s.Widget({node:u});l.id=a.DOMUtils.createDomID(),l.addClass("jp-SubmitWidget"),e.shell.add(l,"top",{rank:1e3}),r.addCommand("jupyter-exam:submit",{label:"Submit Exam",caption:"Submit the exam to the server",execute:()=>{var e;const t=o.currentWidget;if(!t)return void console.error("No notebook is active");const n=null===(e=t.content.model)||void 0===e?void 0:e.toJSON();if(!n)return void console.error("Failed to get notebook data");const a=n;a.metadata&&a.metadata.exam?async function(e){return d("submit",{body:e,method:"POST"})}(JSON.stringify(n)).then((e=>{const{submission:t}=e,{createdAt:o,valid:n}=t,a=new Date(o).toLocaleString("de-DE");n?(l.node.textContent=`Submitted at ${a}`,l.node.style.backgroundColor="#006045"):(l.node.textContent="Exam submissions are closed",l.node.style.backgroundColor="#1d293d")})).catch((e=>{console.error("Failed to submit notebook:",e)})):console.log("Not an exam notebook. Skipping submission.")}}),r.addCommand("jupyter-exam:status",{label:"Check Status",caption:"Check the status of the exam",execute:()=>{(async function(){return d("user")})().then((e=>{const{name:t,sub:o,display_name:n}=e;i.node.textContent=`Jupyter Exam: ${n},  ${t} (${o})`}))}}),t.addItem({command:"jupyter-exam:status",category:"Notebook Operations"}),t.addItem({command:"jupyter-exam:submit",category:"Notebook Operations"}),o.currentChanged.connect(((e,t)=>{t&&(r.execute("jupyter-exam:status"),t.context.saveState.connect(((e,t)=>{"completed"===t&&r.execute("jupyter-exam:submit")})))})),n&&n.load(m.id).then((e=>{console.log("jupyter_exam settings loaded:",e.composite)})).catch((e=>{console.error("Failed to load settings for jupyter_exam.",e)}))}},u=m}}]);