"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["85745"],{50875:function(e,t,a){a.d(t,{Eu:()=>r,hZ:()=>o,o9:()=>c});var s=a(27486),i=a(11259);const n=["#4269d0","#f4bd4a","#ff725c","#6cc5b0","#a463f2","#ff8ab7","#9c6b4e","#97bbf5","#01ab63","#9498a0","#094bad","#c99000","#d84f3e","#49a28f","#048732","#d96895","#8043ce","#7599d1","#7a4c31","#74787f","#6989f4","#ffd444","#ff957c","#8fe9d3","#62cc71","#ffadda","#c884ff","#badeff","#bf8b6d","#b6bac2","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#d9d9d9","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function r(e){return n[e%n.length]}function o(e,t){const a=t.getPropertyValue(`--graph-color-${e+1}`)||r(e);return(0,i.Rq)(a)}const c=(0,s.Z)((e=>n.map(((t,a)=>o(a,e)))),((e,t)=>e[0].getPropertyValue("--graph-color-1")===t[0].getPropertyValue("--graph-color-1")))},6736:function(e,t,a){a.d(t,{f:()=>r});var s=a(61701),i=a(72621),n=(a(19083),a(71695),a(40251),a(61006),a(39527),a(36993),a(47021),a(50778));const r=e=>(0,s.Z)(null,(function(e,t){class a extends t{constructor(...t){super(...t),e(this)}}return{F:a,d:[{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:void 0},{kind:"field",key:"__unsubs",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,i.Z)(a,"connectedCallback",this,3)([]),this._checkSubscribed()}},{kind:"method",key:"disconnectedCallback",value:function(){if((0,i.Z)(a,"disconnectedCallback",this,3)([]),this.__unsubs){for(;this.__unsubs.length;){const e=this.__unsubs.pop();e instanceof Promise?e.then((e=>e())):e()}this.__unsubs=void 0}}},{kind:"method",key:"updated",value:function(e){if((0,i.Z)(a,"updated",this,3)([e]),e.has("hass"))this._checkSubscribed();else if(this.hassSubscribeRequiredHostProps)for(const t of e.keys())if(this.hassSubscribeRequiredHostProps.includes(t))return void this._checkSubscribed()}},{kind:"method",key:"hassSubscribe",value:function(){return[]}},{kind:"method",key:"_checkSubscribed",value:function(){var e;void 0!==this.__unsubs||!this.isConnected||void 0===this.hass||null!==(e=this.hassSubscribeRequiredHostProps)&&void 0!==e&&e.some((e=>void 0===this[e]))||(this.__unsubs=this.hassSubscribe())}}]}}),e)},20548:function(e,t,a){a.d(t,{H:()=>n});a(81804);var s=a(11259),i=a(4643);function n(e,t,a,n,r,o){const c=e.getPropertyValue(r+"-"+o).trim(),d=c.length>0?c:e.getPropertyValue(r).trim();let l=(0,s.Rq)(d);return 0===c.length&&o&&(l=(0,s.CO)((0,s.p3)(t?(0,i.C)((0,s.Rw)((0,s.wK)(l)),o):(0,i.W)((0,s.Rw)((0,s.wK)(l)),o)))),n?l+=a?"32":"7F":a&&(l+="7F"),l}},53259:function(e,t,a){a.a(e,(async function(e,s){try{a.d(t,{J:()=>b,MC:()=>h,Zx:()=>p,b4:()=>f});a(28457),a(71695),a(92745),a(61893),a(5509),a(19423),a(92519),a(42179),a(89256),a(24931),a(88463),a(57449),a(19814),a(88044),a(39527),a(99790),a(41360),a(13334),a(47021);var i=a(21893),n=a(13809),r=a(38836),o=a(50602),c=a(46467),d=a(33570),l=e([c,d,o]);function h(e,t){let a=new Date(t);return e>2&&0===a.getHours()&&(a=(0,i.b)(a,1)),a.setMinutes(0,0,0),e>35&&a.setDate(1),e>2&&a.setHours(0),a.getTime()}function f(e){return e>35?"month":e>2?"day":"hour"}function b(e,t,a,s,i,r,c,d){const l=(0,n.j)(t,e),u=void 0!==r&&void 0!==c;return{xAxis:{type:"time",min:e,max:t},yAxis:{type:"value",name:i,nameGap:5,axisLabel:{formatter:e=>(0,o.uf)(Math.abs(e),a)},splitLine:{show:!0}},grid:{top:35,bottom:10,left:10,right:10,containLabel:!0},tooltip:{trigger:"axis",formatter:e=>{if(Array.isArray(e)){const t=[],n=[];return e.forEach((e=>{var a;null!==(a=e.seriesId)&&void 0!==a&&a.startsWith("compare-")?n.push(e):t.push(e)})),[t,n].filter((e=>e.length>0)).map((e=>v(e,a,s,l,u,i,d))).join("<br><br>")}return v([e],a,s,l,u,i,d)}}}}function v(e,t,a,s,i,n,l){var u,h,f;if(!e[0].value)return"";const b=new Date(null!==(u=null===(h=e[0].value)||void 0===h?void 0:h[2])&&void 0!==u?u:null===(f=e[0].value)||void 0===f?void 0:f[0]);let v;v=s>0?`${(0,c.ud)(b,t,a)}`:`${i?`${(0,c.ud)(b,t,a)}: `:""}${(0,d.mr)(b,t,a)} â€“ ${(0,d.mr)((0,r.T)(b,1),t,a)}`;const p=`<h4 style="text-align: center; margin: 0;">${v}</h4>`;let y=0,g=0,_=0,m=0;const k=e.map((e=>{var a;const s=null===(a=e.value)||void 0===a?void 0:a[1],i=(0,o.uf)(s,t);return"0"!==i&&("bar"===e.componentSubType&&(s>0?(y+=s,g++):(_+=s,m++)),`${e.marker} ${e.seriesName}: ${i} ${n}`)})).filter(Boolean);let S="";return 0!==y&&g>1&&l&&(S+=`<br><b>${l(y)}</b>`),0!==_&&m>1&&l&&(S+=`<br><b>${l(_)}</b>`),k.length>0?`${p}${k.join("<br>")}${S}`:""}function p(e){Array.from(new Set(e.map((e=>e.data.map((e=>e[0])))).flat())).sort(((e,t)=>e-t)).forEach(((t,a)=>{const s={},i={};for(let u=e.length-1;u>=0;u--){var n,r,o,c,d;const h=e[u].data[a],f=h&&"object"==typeof h&&"value"in h?h:{value:h},b=null===(n=f.value)||void 0===n?void 0:n[0],v=null!==(r=e[u].stack)&&void 0!==r?r:"";var l;if(void 0!==b)if(b!==t)null===(l=e[u].data)||void 0===l||l.splice(a,0,{value:[t,0],itemStyle:{borderWidth:0}});else 0===(null===(o=f.value)||void 0===o?void 0:o[1])?e[u].data[a]=Object.assign(Object.assign({},f),{},{itemStyle:Object.assign(Object.assign({},f.itemStyle),{},{borderWidth:0})}):!s[v]&&(null===(c=f.value)||void 0===c?void 0:c[1])>0?(e[u].data[a]=Object.assign(Object.assign({},f),{},{itemStyle:Object.assign(Object.assign({},f.itemStyle),{},{borderRadius:[4,4,0,0]})}),s[v]=!0):!i[v]&&(null===(d=f.value)||void 0===d?void 0:d[1])<0&&(e[u].data[a]=Object.assign(Object.assign({},f),{},{itemStyle:Object.assign(Object.assign({},f.itemStyle),{},{borderRadius:[0,0,4,4]})}),i[v]=!0)}}))}[c,d,o]=l.then?(await l)():l,s()}catch(u){s(u)}}))},63:function(e,t,a){a.a(e,(async function(e,s){try{a.r(t),a.d(t,{HuiEnergySolarGraphCard:()=>w});var i=a(61701),n=(a(71695),a(92745),a(40251),a(39527),a(99790),a(41360),a(36993),a(47021),a(42625)),r=a(83389),o=a(16444),c=a(13809),d=a(57243),l=a(50778),u=a(35359),h=a(27486),f=a(20548),b=a(50602),v=a(25179),p=(a(54977),a(1118)),y=a(17705),g=a(6736),_=a(93331),m=a(53259),k=e([v,b,p,m]);[v,b,p,m]=k.then?(await k)():k;let S,$,j,C,x=e=>e,w=(0,i.Z)([(0,l.Mo)("hui-energy-solar-graph-card")],(function(e,t){return{F:class extends t{constructor(...t){super(...t),e(this)}},d:[{kind:"field",decorators:[(0,l.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,l.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,l.SB)()],key:"_chartData",value(){return[]}},{kind:"field",decorators:[(0,l.SB)()],key:"_start",value(){return(0,n.I)()}},{kind:"field",decorators:[(0,l.SB)()],key:"_end",value(){return(0,r.p)()}},{kind:"field",decorators:[(0,l.SB)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,l.SB)()],key:"_compareEnd",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value(){return["_config"]}},{kind:"method",key:"hassSubscribe",value:function(){var e;return[(0,p.UB)(this.hass,{key:null===(e=this._config)||void 0===e?void 0:e.collection_key}).subscribe((e=>this._getStatistics(e)))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(e){this._config=e}},{kind:"method",key:"shouldUpdate",value:function(e){return(0,_.SN)(this,e)||e.size>1||!e.has("hass")}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?(0,d.dy)(S||(S=x` <ha-card> ${0} <div class="content ${0}"> <ha-chart-base .hass="${0}" .data="${0}" .options="${0}" chart-type="bar"></ha-chart-base> ${0} </div> </ha-card> `),this._config.title?(0,d.dy)($||($=x`<h1 class="card-header">${0}</h1>`),this._config.title):"",(0,u.$)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd),this._chartData.length?"":(0,d.dy)(j||(j=x`<div class="no-data"> ${0} </div>`),(0,o.z)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period"))):d.Ld}},{kind:"field",key:"_formatTotal",value(){return e=>this.hass.localize("ui.panel.lovelace.cards.energy.energy_solar_graph.total_produced",{num:(0,b.uf)(e,this.hass.locale)})}},{kind:"field",key:"_createOptions",value(){return(0,h.Z)(((e,t,a,s,i,n)=>(0,m.J)(e,t,a,s,"kWh",i,n,this._formatTotal)))}},{kind:"method",key:"_getStatistics",value:async function(e){this._start=e.start,this._end=e.end||(0,r.p)(),this._compareStart=e.startCompare,this._compareEnd=e.endCompare;const t=e.prefs.energy_sources.filter((e=>"solar"===e.type));let a;if(t.some((e=>{var t;return null===(t=e.config_entry_solar_forecast)||void 0===t?void 0:t.length})))try{a=await(0,p.jB)(this.hass)}catch(c){}const s=[],i=getComputedStyle(this);if(e.statsCompare)s.push(...this._processDataSet(e.statsCompare,e.statsMetadata,t,i,!0));else{var n,o;const e=null!==(n=null===(o=t[0])||void 0===o?void 0:o.stat_energy_from)&&void 0!==n?n:"placeholder";s.push({id:"compare-"+e,type:"bar",stack:"solar",data:[]})}s.push(...this._processDataSet(e.stats,e.statsMetadata,t,i)),(0,m.Zx)(s),a&&s.push(...this._processForecast(e.statsMetadata,a,t,i.getPropertyValue("--primary-text-color"),e.start,e.end)),this._chartData=s}},{kind:"method",key:"_processDataSet",value:function(e,t,a,s,i=!1){const n=[],r=i?this._start.getTime()-this._compareStart.getTime():0;return a.forEach(((a,o)=>{let c=null;const d=[];if(a.stat_energy_from in e){const t=e[a.stat_energy_from];for(const e of t){if(null===e.change||void 0===e.change||0===e.change)continue;if(c===e.start)continue;const t=[e.start,e.change];i&&(t[2]=t[0],t[0]+=r),d.push(t),c=e.start}}n.push({type:"bar",cursor:"default",id:i?"compare-"+a.stat_energy_from:a.stat_energy_from,name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_solar_graph.production",{name:(0,y.Kd)(this.hass,a.stat_energy_from,t[a.stat_energy_from])}),barMaxWidth:50,itemStyle:{borderColor:(0,f.H)(s,this.hass.themes.darkMode,!1,i,"--energy-solar-color",o)},color:(0,f.H)(s,this.hass.themes.darkMode,!0,i,"--energy-solar-color",o),data:d,stack:i?"compare":"solar"})})),n}},{kind:"method",key:"_processForecast",value:function(e,t,a,s,i,n){const r=[],o=(0,c.j)(n||new Date,i);return a.forEach((a=>{if(a.config_entry_solar_forecast){const c={};if(a.config_entry_solar_forecast.forEach((e=>{t[e]&&Object.entries(t[e].wh_hours).forEach((([e,t])=>{const a=new Date(e);if(a<i||n&&a>n)return;o>35&&a.setDate(1),o>2?a.setHours(0,0,0,0):a.setMinutes(0,0,0);const s=a.getTime();s in c?c[s]+=t:c[s]=t}))})),c){const t=[];for(const[e,a]of Object.entries(c))t.push([Number(e),a/1e3]);t.length&&r.push({id:"forecast-"+a.stat_energy_from,type:"line",name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_solar_graph.forecast",{name:(0,y.Kd)(this.hass,a.stat_energy_from,e[a.stat_energy_from])}),step:!1,color:s,lineStyle:{type:[7,5],width:1.5},symbol:"none",data:t})}}})),r}},{kind:"field",static:!0,key:"styles",value(){return(0,d.iv)(C||(C=x`ha-card{height:100%}.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:32px;margin-inline-start:32px;margin-inline-end:initial;box-sizing:border-box}`))}}]}}),(0,g.f)(d.oi));s()}catch(S){s(S)}}))},41924:function(e,t,a){a.d(t,{y:()=>i});var s=a(53907);function i(e){return(0,s.L)(e,Date.now())}},97836:function(e,t,a){a.d(t,{K:()=>n});a(71695),a(47021);var s=a(18492),i=a(7591);function n(e,t,a){const[n,r]=(0,s.d)(null==a?void 0:a.in,e,t);return+(0,i.b)(n)==+(0,i.b)(r)}},16444:function(e,t,a){a.d(t,{z:()=>r});var s=a(53907),i=a(41924),n=a(97836);function r(e,t){return(0,n.K)((0,s.L)((null==t?void 0:t.in)||e,e),(0,i.y)((null==t?void 0:t.in)||e))}}}]);
//# sourceMappingURL=85745.465f7b74aefe7764.js.map