import pytest
from pymatgen.core.structure import Structure
from autoplex.data.phonons.utils import reduce_supercell_size

@pytest.fixture(scope="class")
def mp_1203790():
    return Structure.from_dict(  # mp-1203790
        {'@module': 'pymatgen.core.structure', '@class': 'Structure', 'charge': 0, 'lattice': {
            'matrix': [[-5.18331847, -8.9777624, 0.0], [-5.18331547, 8.97776139, -0.0], [0.0, 0.0, -16.97027249]],
            'pbc': (True, True, True), 'a': 10.36662954254163, 'b': 10.366627167855322, 'c': 16.97027249, 'alpha': 90.0,
            'beta': 90.0, 'gamma': 119.99996435798555, 'volume': 1579.409195104524}, 'properties': {}, 'sites': [
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.95006076, 0.66941597, 0.56452266],
             'xyz': [-8.394261638096292, -2.519562919528026, -9.580103366979623], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.71935521, 0.04993924, 0.56452366],
                              'xyz': [-3.9874979817357716, -6.009857575864161, -9.580120337252113],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.33058503, 0.28064479, 0.56452266],
             'xyz': [-3.1681979734864054, -0.44835189237021433, -9.580103366979623], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.71935321, 0.66941397, 0.56452366],
                              'xyz': [-7.1984205663819045, -0.4483433072646852, -9.580120337252113],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.33058603, 0.04993924, 0.56452366],
             'xyz': [-1.9723835104750167, -2.519580249381328, -9.580120337252113], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.95006076, 0.28064579, 0.56452366],
                              'xyz': [-6.379143149827607, -6.0098488311153755, -9.580120337252113],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.04993924, 0.33058403, 0.43547534],
             'xyz': [-1.972372301903707, 2.5195619095280253, -7.3901351824753965], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.28064479, 0.95006076, 0.43547534],
                              'xyz': [-6.379135958264228, 6.00985656586416, -7.3901351824753965],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.66941597, 0.71935521, 0.43547534],
             'xyz': [-7.198441149832064, 0.44834190460781453, -7.3901351824753965], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.28064679, 0.33058603, 0.43547534],
                              'xyz': [-3.1682133736180953, 0.44834229726468555, -7.3901351824753965],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.66941497, 0.95006076, 0.43547534],
             'xyz': [-8.394255612843452, 2.519570261618928, -7.3901351824753965], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.04993924, 0.71935421, 0.43547534],
                              'xyz': [-3.9874907901723917, 6.009847821115375, -7.3901351824753965],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.04994024, 0.33058403, 0.06452466],
             'xyz': [-1.972377485222177, 2.5195529317656256, -1.0950010625246034], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.28064479, 0.95005976, 0.06452466],
                              'xyz': [-6.3791307749487585, 6.009847588102771, -1.0950010625246034],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.66941497, 0.71935521, 0.06452466],
             'xyz': [-7.198435966513594, 0.4483508823702138, -1.0950010625246034], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.28064679, 0.33058603, 0.06452466],
                              'xyz': [-3.1682133736180953, 0.44834229726468555, -1.0950010625246034],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.66941397, 0.95005976, 0.06452466],
             'xyz': [-8.394245246209513, 2.519570261619939, -1.0950010625246034], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.04994024, 0.71935421, 0.06452466],
                              'xyz': [-3.9874959734908617, 6.009838843352975, -1.0950010625246034],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.95005976, 0.66941597, 0.93547734],
             'xyz': [-8.394256454777823, -2.5195539417656256, -15.875305368020376], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.71935521, 0.04994024, 0.93547634],
                              'xyz': [-3.9875031650512414, -6.009848598102771, -15.875288397747886],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.33058503, 0.28064479, 0.93547634],
             'xyz': [-3.1681979734864054, -0.44835189237021433, -15.875288397747886], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.71935321, 0.66941397, 0.93547634],
                              'xyz': [-7.1984205663819045, -0.4483433072646852, -15.875288397747886],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.33058603, 0.04994024, 0.93547634],
             'xyz': [-1.9723886937904866, -2.519571271619938, -15.875288397747886], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.95005976, 0.28064579, 0.93547634],
                              'xyz': [-6.379137966509138, -6.009839853352975, -15.875288397747886],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.91572454, 0.45786277, 0.86478307],
             'xyz': [-7.119739100492306, -4.110574645544846, -14.675604342638744], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.54213923, 0.08427546, 0.86478307],
                              'xyz': [-3.246906579729944, -4.110592223746462, -14.675604342638744],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.54213723, 0.45786077, 0.86478307],
             'xyz': [-5.18330672978075, -0.7566144962324817, -14.675604342638744], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.08427546, 0.54213723, 0.13521793],
                              'xyz': [-3.246894839507694, 4.110573635544846, -2.2946851176337453],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.45786077, 0.91572454, 0.13521793],
             'xyz': [-7.119727360270056, 4.110591213746463, -2.2946851176337453], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.45786277, 0.54213923, 0.13521793],
                              'xyz': [-5.18332721021925, 0.7566134862324816, -2.2946851176337453],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.08427646, 0.54213723, 0.36478107],
             'xyz': [-3.246900022826164, 4.1105646577824455, -6.1904341570937635], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.45786077, 0.91572354, 0.36478107],
                              'xyz': [-7.1197221769545855, 4.110582235985073, -6.1904341570937635],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.45786277, 0.54214023, 0.36478107],
             'xyz': [-5.1833323935347195, 0.7566224639938719, -6.1904341570937635], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.91572354, 0.45786277, 0.63521793],
                              'xyz': [-7.119733917173836, -4.110565667782446, -10.779821362633745],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.54213923, 0.08427646, 0.63521793],
             'xyz': [-3.2469117630454143, -4.1105832459850715, -10.779821362633745], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.54213723, 0.45785977, 0.63521793],
                              'xyz': [-5.18330154646528, -0.756623473993872, -10.779821362633745],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.87645037, 0.12354863, 0.36130919],
             'xyz': [-5.18331291603564, -6.759373057050692, -6.131515407441183], 'properties': {'magmom': 0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.24709825, 0.12354963, 0.36130919],
                              'xyz': [-1.9211856316214535, -1.1091902799930142, -6.131515407441183],
                              'properties': {'magmom': 0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.87645037, 0.75290175, 0.36130919],
             'xyz': [-8.445448679024407, -1.1091909156386555, -6.131515407441183], 'properties': {'magmom': 0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.12354963, 0.87645137, 0.63868881],
                              'xyz': [-5.18332102396436, 6.759372047050691, -10.838723142013837],
                              'properties': {'magmom': 0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.75290175, 0.87645037, 0.63868881],
             'xyz': [-8.445448308378547, 1.1091892699930135, -10.838723142013837], 'properties': {'magmom': 0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.12354963, 0.24709825, 0.63868881],
                              'xyz': [-1.9211852609755935, 1.1091899056386554, -10.838723142013837],
                              'properties': {'magmom': 0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.12354963, 0.87645137, 0.86131119],
             'xyz': [-5.18332102396436, 6.759372047050691, -14.616685592986162], 'properties': {'magmom': 0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.75290175, 0.87645037, 0.86131119],
                              'xyz': [-8.445448308378547, 1.1091892699930135, -14.616685592986162],
                              'properties': {'magmom': 0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.12354963, 0.24709825, 0.86131119],
             'xyz': [-1.9211852609755935, 1.1091899056386554, -14.616685592986162], 'properties': {'magmom': 0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.87645037, 0.12354863, 0.13869081],
                              'xyz': [-5.18331291603564, -6.759373057050692, -2.353620837558817],
                              'properties': {'magmom': 0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.24709825, 0.12354963, 0.13868981],
             'xyz': [-1.9211856316214535, -1.1091902799930142, -2.353603867286327], 'properties': {'magmom': 0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.87645037, 0.75290175, 0.13868981],
                              'xyz': [-8.445448679024407, -1.1091909156386555, -2.353603867286327],
                              'properties': {'magmom': 0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.666667, 0.333333, 0.8196504],
             'xyz': [-5.183317470001, -2.99259378850793, -13.909690634537496], 'properties': {'magmom': 0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.333333, 0.666667, 0.1803516],
                              'xyz': [-5.183316469999, 2.9925927785079303, -3.060615796007484],
                              'properties': {'magmom': 0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.333333, 0.666667, 0.3196484],
             'xyz': [-5.183316469999, 2.9925927785079303, -5.424520448992515], 'properties': {'magmom': 0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.666667, 0.333333, 0.6803506],
                              'xyz': [-5.183317470001, -2.99259378850793, -11.545735070734993],
                              'properties': {'magmom': 0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [-0.0, -0.0, 0.81830178],
             'xyz': [0.0, 0.0, -13.886804185652032], 'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [-0.0, -0.0, 0.18169922],
             'xyz': [0.0, 0.0, -3.0834852746204575], 'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [-0.0, -0.0, 0.31829978],
             'xyz': [0.0, 0.0, -5.401634000107052], 'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [-0.0, -0.0, 0.68169922],
             'xyz': [0.0, 0.0, -11.568621519620459], 'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.93042857, 0.46521428, 0.25],
             'xyz': [-7.234059966285599, -4.1765838305711185, -4.2425681225], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.53478672, 0.06957143, 0.25],
                              'xyz': [-3.1325805526757406, -4.1765924087342405, -4.2425681225],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.53478472, 0.46521328, 0.25],
             'xyz': [-5.18330670772322, -0.6245963280112683, -4.2425681225], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.06957243, 0.53478572, 0.75],
                              'xyz': [-3.132579157032871, 4.176573842808719, -12.7277043675],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.46521228, 0.93042757, 0.75],
             'xyz': [-7.2340430206903195, 4.176591398735249, -12.7277043675], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.46521428, 0.53478772, 0.75],
                              'xyz': [-5.183327232273779, 0.6246132735350587, -12.7277043675],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.79765372, 0.20234828, 0.25],
             'xyz': [-5.1833282295920995, -5.344511000119218, -4.2425681225], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.40469355, 0.20234628, 0.25],
                              'xyz': [-3.14648015582582, -1.816625916718391, -4.2425681225],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.79765172, 0.59530645, 0.25],
             'xyz': [-7.220144024579049, -1.8166083580833616, -4.2425681225], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.20234628, 0.79765172, 0.75],
                              'xyz': [-5.1833057104079, 5.344509990119218, -12.7277043675],
                              'properties': {'magmom': -0.0}, 'label': 'Si'},
            {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.59530545, 0.79765272, 0.75],
             'xyz': [-7.220143417540241, 1.816624906719401, -12.7277043675], 'properties': {'magmom': -0.0},
             'label': 'Si'}, {'species': [{'element': 'Si', 'occu': 1}], 'abc': [0.20234928, 0.40469455, 0.75],
                              'xyz': [-3.14650028205489, 1.8166073480823524, -12.7277043675],
                              'properties': {'magmom': -0.0}, 'label': 'Si'}]})


def test_reduce_supercell_size(mp_1203790):
    red_sc_mat = reduce_supercell_size(mp_1203790)

    assert red_sc_mat == [[-2, -1, 0], [-2, 1, 0], [0, 0, -1]]